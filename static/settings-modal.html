<div id="settings-overlay" class="settings-overlay hidden">
  <div class="settings-modal" role="dialog" aria-modal="true" aria-labelledby="settings-title">
    <div class="settings-header">
      <div class="settings-title-group">
        <h2 id="settings-title" class="settings-title">Settings</h2>
        <div class="settings-subtitle">Preferences are stored per browser on this device.</div>
      </div>
      <button
        type="button"
        id="settings-close-btn"
        class="settings-header-close"
        aria-label="Close settings"
      >
        &times;
      </button>
    </div>
    <div class="settings-body">
      <nav class="settings-nav" aria-label="Settings categories">
        <button
          type="button"
          class="settings-nav-item selected"
          data-category="general"
        >
          General
        </button>
        <button
          type="button"
          class="settings-nav-item"
          data-category="file-handling"
        >
          File handling
        </button>
        <button
          type="button"
          class="settings-nav-item"
          data-category="versioning"
        >
          Versioning
        </button>
        <button
          type="button"
          class="settings-nav-item"
          data-category="appearance"
        >
          Appearance
        </button>
        <button
          type="button"
          class="settings-nav-item"
          data-category="shortcuts"
        >
          Keyboard Shortcuts
        </button>
      </nav>
      <div class="settings-content">
        <section class="settings-category-panel" data-category="general">
          <h3 class="settings-category-title">General</h3>
          <div class="settings-field">
            <label class="settings-field-label">
              <input type="checkbox" id="settings-editor-spellcheck" />
              Enable spellcheck in the editor
            </label>
            <p class="settings-field-description">
              When enabled, the browser's built-in spellchecker will be active in the markdown editor.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-index-page-title">
              Index page title
            </label>
            <input
              type="text"
              id="settings-index-page-title"
              class="settings-input-text"
              placeholder="NoteBooks"
            />
            <p class="settings-field-description">
              Sets the title shown in the header and browser tab on the index page.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-tab-length">
              Tab width (spaces)
            </label>
            <input
              type="number"
              id="settings-tab-length"
              class="settings-input-number"
              min="1"
            />
            <p class="settings-field-description">
              Controls how many spaces a tab character counts for in markdown rendering and editor behavior.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-date-format">
              Date format pattern
            </label>
            <input
              type="text"
              id="settings-date-format"
              class="settings-input-text"
              placeholder="YYYY-MM-DD"
            />
            <p class="settings-field-description">
              Pattern used when inserting the current date with the Ctrl+; shortcut (tokens: YYYY, MM, DD).
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-time-format">
              Time format pattern
            </label>
            <input
              type="text"
              id="settings-time-format"
              class="settings-input-text"
              placeholder="HH:mm"
            />
            <p class="settings-field-description">
              Pattern used when inserting the current time with the Ctrl+Shift+; shortcut (tokens: HH, mm, ss).
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Notebook export / import</div>
            <button type="button" id="settings-export-notebook-btn" class="settings-btn">
              Export Notebook
            </button>
            <button type="button" id="settings-import-notebook-btn" class="settings-btn">
              Import Notebook
            </button>
            <p class="settings-field-description">
              Export downloads a zip archive of the notebook (notes and core project files). Import restores notes into the current notebook from a previously exported zip.
            </p>
          </div>
        </section>
        <section class="settings-category-panel hidden" data-category="file-handling">
          <h3 class="settings-category-title">File handling</h3>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-image-display-mode">
              Image display mode
            </label>
            <select id="settings-image-display-mode" class="settings-select">
              <option value="fit-width">Fit to note width</option>
              <option value="max-size">Max width / height</option>
            </select>
            <p class="settings-field-description">
              Controls how images are sized when shown in the note viewer. This only affects display, not the original file size.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-image-max-width">
              Max image width (px)
            </label>
            <input
              type="number"
              id="settings-image-max-width"
              class="settings-input-number"
              min="0"
            />
            <p class="settings-field-description">
              When using max width / height mode, limits how wide images can appear. Leave blank or 0 for no explicit width limit.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-image-max-height">
              Max image height (px)
            </label>
            <input
              type="number"
              id="settings-image-max-height"
              class="settings-input-number"
              min="0"
            />
            <p class="settings-field-description">
              When using max width / height mode, limits how tall images can appear. Leave blank or 0 for no explicit height limit.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-image-default-alignment">
              Default image alignment
            </label>
            <select
              id="settings-image-default-alignment"
              class="settings-select"
            >
              <option value="left">Left (default)</option>
              <option value="center">Center</option>
              <option value="right">Right</option>
            </select>
            <p class="settings-field-description">
              Controls how images are aligned in the note viewer.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-image-storage-path">
              Image storage subfolder
            </label>
            <input
              type="text"
              id="settings-image-storage-path"
              class="settings-input-text"
              placeholder="images"
            />
            <p class="settings-field-description">
              Folder under the notebook root where pasted images are stored (for example <code>images</code>). Must stay within the notes folder.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-image-max-size-mb">
              Max pasted image size (MB)
            </label>
            <input
              type="number"
              id="settings-image-max-size-mb"
              class="settings-input-number"
              min="1"
            />
            <p class="settings-field-description">
              Soft limit for image size when pasting into a note. If exceeded, you will be asked to confirm before the image is uploaded.
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Images maintenance</div>
            <button type="button" id="settings-images-cleanup-btn" class="settings-btn">
              Run image cleanup
            </button>
            <p class="settings-field-description">
              Scans notes for referenced images and deletes unreferenced image files from the configured image storage folder.
            </p>
          </div>
        </section>
        <section class="settings-category-panel hidden" data-category="versioning">
          <h3 class="settings-category-title">Versioning</h3>
          <div class="settings-field">
            <label class="settings-field-label">
              <input type="checkbox" id="settings-auto-commit-notes" />
              Automatically commit and push notes after saving
            </label>
            <p class="settings-field-description">
              When enabled, saving a note will also commit and push changes to the configured GitHub notes repository.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label">
              <input type="checkbox" id="settings-auto-pull-notes" />
              Automatically pull notes from the repository
            </label>
            <p class="settings-field-description">
              When enabled, the app will periodically pull changes from the configured GitHub notes repository.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-auto-pull-interval">
              Auto-pull interval (minutes)
            </label>
            <input
              type="number"
              id="settings-auto-pull-interval"
              class="settings-input-number"
              min="1"
            />
            <p class="settings-field-description">
              How often to check for and pull updates when automatic notes pulling is enabled.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-auto-save-interval">
              Auto-save interval (seconds)
            </label>
            <input
              type="number"
              id="settings-auto-save-interval"
              class="settings-input-number"
              min="0"
            />
            <p class="settings-field-description">
              When greater than 0, notes in edit mode are automatically saved at this interval. Leave blank or set to 0 to disable periodic auto-save.
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Repositories &amp; GitHub API<br></div>
            <p class="settings-field-description">
              Notes repo path: <code id="versioning-notes-root">Loading…</code>
            </p>
            <p class="settings-field-description">
              Notes remote URL: <code id="versioning-notes-remote-url">Loading…</code>
            </p>
            <p class="settings-field-description">
              GitHub API key: <span id="versioning-github-api-key-status">Loading…</span>
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Git history</div>
            <div class="settings-field-description">
              <button
                type="button"
                id="versioning-view-app-history-btn"
                class="settings-btn"
              >
                View app repository history
              </button>
              <button
                type="button"
                id="versioning-view-notes-history-btn"
                class="settings-btn"
              >
                View notes repository history
              </button>
            </div>
            <div class="settings-field-description">
              <div
                id="versioning-git-history-popup"
                class="settings-git-history-popup hidden"
                role="dialog"
                aria-modal="true"
                aria-labelledby="versioning-git-history-title"
              >
                <div class="settings-header">
                  <div class="settings-title-group">
                    <h3
                      id="versioning-git-history-title"
                      class="settings-title"
                    >
                      Git history
                    </h3>
                  </div>
                  <button
                    type="button"
                    id="versioning-git-history-close-btn"
                    class="settings-header-close"
                    aria-label="Close git history"
                  >
                    &times;
                  </button>
                </div>
                <div
                  id="versioning-git-history-body"
                  class="settings-field-description"
                ></div>
              </div>
            </div>
          </div>
        </section>
        <section class="settings-category-panel hidden" data-category="appearance">
          <h3 class="settings-category-title">Appearance</h3>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-theme">
              Theme
            </label>
            <select id="settings-theme" class="settings-select">
              <option value="gruvbox-dark">Gruvbox dark</option>
              <option value="office">Office (default)</option>
              <option value="high-contrast">High contrast</option>
              <option value="midnight">Midnight</option>
            </select>
            <p class="settings-field-description">
              Changes are previewed immediately. Click Save to keep them.
            </p>
          </div>
          <div class="settings-field">
            <label class="settings-field-label" for="settings-export-theme">
              Export theme
            </label>
            <select id="settings-export-theme" class="settings-select">
              <option value="match-app-theme">Match app theme (default)</option>
              <option value="gruvbox-dark">Gruvbox dark</option>
              <option value="office">Office</option>
              <option value="high-contrast">High contrast</option>
              <option value="Midnight">Midnight</option>
            </select>
            <p class="settings-field-description">
              Chooses the theme used when exporting a note as HTML.
            </p>
          </div>
        </section>
        <section class="settings-category-panel hidden" data-category="shortcuts">
          <h3 class="settings-category-title">Keyboard Shortcuts</h3>
          <div class="settings-field">
            <p class="settings-field-description">
              Editor shortcuts are active when the note editor has focus. When the cursor is inside inline code or fenced code blocks, only <code>Ctrl+S</code>, indent / unindent, and <code>Ctrl+Shift+D</code> remain active. Other editor shortcuts are disabled so they do not modify code, while browser and system shortcuts continue to work normally.
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Formatting</div>
            <p class="settings-field-description">
              <code>Ctrl+B</code> – Toggle bold (<code>**text**</code>) around the selection.<br />
              <code>Ctrl+I</code> – Toggle italics (<code>*text*</code>) around the selection.<br />
              <code>Ctrl+K</code> – Insert or wrap as a Markdown link (<code>[text]()</code>).<br />
              <code>Ctrl+Shift+K</code> – Toggle inline code using backticks (<code>`code`</code>).<br />
              <code>Ctrl+Shift+C</code> – Toggle a fenced code block with triple backticks.<br />
              <code>Ctrl+Shift+I</code> – Insert or wrap as an image reference (<code>![alt]()</code>).
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Headings and lists</div>
            <p class="settings-field-description">
              <code>Ctrl+H</code> – Cycle heading level at the start of selected lines (#, ##, ###, then back to plain text).<br />
              <code>Ctrl+L</code> – Toggle checklist items (<code>- [ ]</code>) for selected lines.<br />
              <code>Ctrl+U</code> – Toggle unordered list bullets (<code>-</code>) for selected lines.<br />
              <code>Ctrl+Shift+O</code> – Toggle ordered list numbering (<code>1.</code>) for selected lines.
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Indenting and duplication</div>
            <p class="settings-field-description">
              <code>Tab</code> – Indent selected lines using the configured tab width.<br />
              <code>Shift+Tab</code> – Unindent selected lines.<br />
              <code>Ctrl+Shift+&gt;</code> – Indent selected lines (same as Tab).<br />
              <code>Ctrl+Shift+&lt;</code> – Unindent selected lines (same as Shift+Tab).<br />
              <code>Ctrl+Shift+D</code> – Duplicate the current line or selected block.
            </p>
          </div>
          <div class="settings-field">
            <div class="settings-field-label">Saving and formatting</div>
            <p class="settings-field-description">
              <code>Ctrl+S</code> – Manually save the current note without opening the browser's save dialog.<br />
              <code>Ctrl+Shift+E</code> – Toggle between reader and editor modes for the current note.<br />
              <code>Alt+Shift+F</code> – Reserved for future document formatting. The shortcut is captured but currently does not modify the note.
            </p>
          </div>
        </section>
      </div>
    </div>
    <div class="settings-footer">
      <button type="button" id="settings-cancel-btn" class="settings-btn">
        Cancel
      </button>
      <button type="button" id="settings-save-btn" class="settings-btn settings-btn-primary">
        Save
      </button>
    </div>
  </div>
</div>
